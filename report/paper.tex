\documentclass{article}
\usepackage{solidity}
\usepackage{hyperref}
\title{SWC-116: Block values as a proxy for time}
\author{Lorenz Kofler and Jonas Fischer}
\date{13 October 2023}
\bibliographystyle{IEEEtran}
\begin{document}
\maketitle
\tableofcontents
\newpage

\section{Introduction}
This report deals with a weakness in Solidity smart contracts, which is called
"block values as a proxy for time". This weakness is described in the Smart
Contract Weakness Classification (SWC) registry under the number 116. \newline
The weakness comes from the attempt of developers to introduce time depended
functionality in their smart contracts, by reading the values block.timestamp
or block.number \cite{swc116}. \newline

\section{Background}

\subsection{block.timestamp}
But because Ethereum is decentralized, this information is controlled by
miners. There is no restriction how the miners have to set the timestamp. It
only needs to be higher then the timestamp of the previous block \cite{Conkas2021}.
\begin{equation} \label{eq:1}
H_s > P(H)_{H_s}
\end{equation}
The timestamp of the block $H_s$ in \ref{eq:1} must be greater then the timestamp of the previous block $P(H)_{H_s}$ \cite{ethyellowpaper2023}.

consensus/ethash/consensus.go
\begin{lstlisting}[laguage=go, caption="\cite{timestamp_code}"]
func (ethash *Ethash) verifyHeader(chain consensus.ChainHeaderReader, header, parent *types.Header, uncle bool, unixNow int64) error {
  ...
	// Verify the header's timestamp
		if header.Time > uint64(unixNow+allowedFutureBlockTimeSeconds) {
			return consensus.ErrFutureBlock
		}
	if header.Time <= parent.Time {
		return errOlderBlockTime
	}
  ...
}
\end{lstlisting}
%todo
\cite{timestamp_code}

\subsection{block.number}


\section{Variantes of the weakness}

\subsection{Block - Timestamp}
\subsubsection{Background}

\subsection{Block - Number}
\subsection{Non weaknesses}

\section{Examples}
\section{Consequences}
\section{Tools}
\section{Exploits}

\subsection{Example1 - Game}
\begin{solidity}
    function play() public {
        require(now > 1521763200 && neverPlayed == true);
        neverPlayed = false;
        msg.sender.transfer(1500 ether);
    }
\end{solidity}
Source: NCC Group - Time manipulation \cite{DASP2018}

\section{Infos}
There is neither a lower nor an upper bound on the number of pages. Assume that
the reader is familiar with Ethereum and Smart Contracts, and just write what
is necessary. It is a technical report, not an essay, so stick to the facts. As
a sign of professionalism, proofread the paper and eliminate spelling and
grammatical errors. You may use chatGPT or a similar tool to polish the paper,
but take care that it does not introduce nonsense.

Write the paper in English. Typeset it in \LaTeX. The document class
\verb"article" is fine, but you may use fancier formatting if you prefer. See
the source of this document for an example.

For Solidity code, add the line  \verb"\usepackage{solidity}" to your preamble
and wrap the code in a \verb"solidity" environment, like below.
\begin{solidity}
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;
contract HelloWorld {
    string public greet = "Hello World!";
}
\end{solidity}

The citation information for the papers in the TUWEL course is provided
in the file \verb"seminar.bib". Add any further papers that you want to cite.
Cite only the papers that you really need.
Currently, \verb"seminar.bib" contains the following references.
\nocite{*}

\bibliography{seminar}
\end{document}

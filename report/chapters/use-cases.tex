\section{Use-cases}

\subsection{Timelocks for ICO}
https://blog.openzeppelin.com/bypassing-smart-contract-timelocks

\subsection{Timelocks}
A timelock is a smart contract that serves as a mechanism to delay function calls form another contract for
a predefined amount of time. Timelocks find their primary application in governance systems,
where they play a crucial role in implementing delayed administrative actions.
Their presence often signifies the credibility of a project and underscores the commitment of its owners
to its long-term success. \cite{timelock2021}.

Openzeppelin provides such a timelock in their library (@openzeppelin/contracts/governance/TimelockController.sol).
A part of this timelock code can be seen in Listing \ref{lst:timelock} \cite{timelock_code}.

\lstinputlisting[language=Solidity, caption={Openzeppelin Timelock}, label={lst:timelock}]{../dev/contracts/timelock.sol}

\subsection{State Machine}
Contracts often act as a state machine. It's common to have multi-stage
processes where certain actions are allowed only during specific phases.
Timestamps can be used to enforce time-based conditions within a contract \cite{soliditydocs_statemaschine}. \\
The following example shows a contract that implements the transition of stages (states) based on timestamps \cite{stagedcontract_code}.

\begin{solidity}
modifier timedTransitions() {
    if (stage == Stages.AcceptingBlindBids && block.timestamp >= creationTime + 6 days) {
        nextStage();
    }
    if (stage == Stages.RevealBids && block.timestamp >= creationTime + 10 days) {
        nextStage();
    }
    _;
}
\end{solidity}

\section{Best practices}
- Avoid using block.number in PoW as a proxy for time, because it is not guaranteed that the block time is fixed at 14 seconds \\
- Avoid using block.number in PoS as a proxy for time, because the block time can be a multiple of 12 seconds and may change in the future (instead use block.timestamp)\\
- Avoid using block.timestamp in PoW, because it can be manipulated by miners \\
- Avoid using block.timestamp in PoS for triggering events with an exact time (more accurate than 12 seconds, e.g. silvester) \\
- It is safe to use block.timestamp in PoS, if the time-dependent event must only be higher than a certain timestamp (e.g. timelocks) \\
- Never use block.timestamp in a comparison (do not do: e.g. block.timestamp == 1702446773), instead use $>$ or $>=$

\section{Example contracts}
- Firework.sol (timestamp based) - both bad \\
- FastWithdrawChallenge.sol (timestamp based) - PoW bad, PoS ok (not considering other weaknesses) \\
- BlockNumberTimeLock.sol (block number as a proxy for time) - both bad \\
- BlockNumberLock.sol (block number only) - both good if the block count is more relevant than the exact time
(the approximate duration until unlock is more precise under PoS then under PoW) \\
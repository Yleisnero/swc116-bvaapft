const timeTravelHelper = require("../helpers/time_travel_helper_for_truffle");
const TimeLock = artifacts.require("TimeLock");

module.exports = async function (callback) {
    let timeLockAddress = "0x1114ede81f1baa08f2a0f29ee77e6404e7f7ee52";

    var timeLock = new TimeLock(timeLockAddress);
    const lockTime = 140;
    var balanceBefore =  await web3.eth.getBalance(timeLockAddress);
    console.log("Contract balance: " + balanceBefore);

    await timeLock.lockEth(lockTime, 1, { value: 1 });

    console.log("Contract balance: " + await web3.eth.getBalance(timeLockAddress));
    console.log("Current block number: " + await web3.eth.getBlockNumber());

    for (var i = 0; i < lockTime / 14; i++) {
        await timeTravelHelper.advanceBlock();
    }
    console.log("Current block number: " + await web3.eth.getBlockNumber());

    await timeLock.withdraw();
    
    console.log("Contract balance: " + await web3.eth.getBalance(timeLockAddress));
    console.log("Should be         " + balanceBefore);
    
    callback();
}